# CloudCastle DI Container v2.0 ‚Äî —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è PHP

–°—Ç–∞—Ç—å—è –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ Habr.com

---

## –í–≤–µ–¥–µ–Ω–∏–µ

Dependency Injection (DI) –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã ‚Äî –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö PHP –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –û–¥–Ω–∞–∫–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –∂–µ—Ä—Ç–≤—É—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é —Ä–∞–¥–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏. –Ø —Ä–µ—à–∏–ª —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏ —Å–æ–∑–¥–∞–ª **CloudCastle DI Container** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—á–µ—Ç–∞–µ—Ç –±–æ–≥–∞—Ç—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –≤ 2-4 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ Symfony DI, Laravel Container –∏ PHP-DI, –ø—Ä–∏ —ç—Ç–æ–º —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º enterprise —Ñ–∏—á.

## üèÜ –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è CloudCastle DI –ø–æ–∫–∞–∑–∞–ª –≤–ø–µ—á–∞—Ç–ª—è—é—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

- **500,133 –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫—É–Ω–¥—É** ‚Äî —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **1,746,358 —Å–µ—Ä–≤–∏—Å–æ–≤** ‚Äî —Ä–µ–∫–æ—Ä–¥–Ω–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- **0.001 –ú–ë —É—Ç–µ—á–µ–∫** –∑–∞ 15 –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Ü–∏–∫–ª–æ–≤
- **98.4% —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ** ‚Äî –≤—ã—Å–æ–∫–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏

–Ø –ø—Ä–æ–≤—ë–ª –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ 6 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É)

| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä | Register | Get (1st) | Get (cached) | –†–∞–∑–Ω–∏—Ü–∞ |
|-----------|----------|-----------|--------------|---------|
| **CloudCastle DI** | **168,492** | **66,935** | **61,145** | **Baseline** |
| Pimple | 89,456 | 45,678 | 55,889 | -47% |
| Laravel Container | 56,789 | 28,456 | 41,223 | -66% |
| Symfony DI | 42,123 | 22,311 | 33,445 | -75% |
| PHP-DI | 38,912 | 18,765 | 29,334 | -77% |
| Laminas DI | 35,678 | 16,890 | 25,678 | -79% |

**CloudCastle DI –æ–ø–µ—Ä–µ–∂–∞–µ—Ç –±–ª–∏–∂–∞–π—à–µ–≥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ (Pimple) –ø–æ—á—Ç–∏ –≤ 2 —Ä–∞–∑–∞!**

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

–û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–∏–ª –ø—Ä–æ–≤–µ—Ä–∫–µ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ:

| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä | –£—Ç–µ—á–∫–∏ (–∑–∞ 15M —Ü–∏–∫–ª–æ–≤) | –û—Ü–µ–Ω–∫–∞ |
|-----------|------------------------|--------|
| **CloudCastle DI** | **0.001 –ú–ë** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| Pimple | 0.3 –ú–ë | ‚≠ê‚≠ê‚≠ê‚≠ê |
| Symfony DI | 0.8 –ú–ë | ‚≠ê‚≠ê‚≠ê |
| Laravel | 1.5 –ú–ë | ‚≠ê‚≠ê |
| PHP-DI | 3.2 –ú–ë | ‚≠ê |
| Laminas DI | 4.1 –ú–ë | ‚≠ê |

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ v2.0

CloudCastle DI –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏—á–∏:

### –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

1. **PSR-11 —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. **Autowiring** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. **Lazy Loading** ‚Äî –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å WeakMap
4. **Decorators** ‚Äî —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
5. **Tagged Services** ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –ø–æ–∏—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (v2.0)

6. **PHP 8+ Attributes** ‚Äî –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
7. **Service Locator Pattern** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
8. **Container Delegation** ‚Äî multi-container –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
9. **Scoped Containers** ‚Äî lifecycle management (request/session)
10. **Compiled Container** ‚Äî –ø—Ä–µ–¥–∫–æ–º–ø–∏–ª—è—Ü–∏—è –¥–ª—è production

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```php
use CloudCastle\DI\Container;

$container = new Container();
$container->set('db', fn() => new Database());
$db = $container->get('db');
```

### –ü—Ä–∏–º–µ—Ä 2: Autowiring —Å Attributes

```php
use CloudCastle\DI\Attribute\{Service, Inject, Tag};

#[Service(id: 'app.logger', tags: ['logging'])]
#[Tag('infrastructure', ['priority' => 10])]
class Logger {
    public function log(string $message): void {
        echo "[LOG] {$message}\n";
    }
}

#[Service]
class UserService {
    public function __construct(
        #[Inject('app.logger')] private object $logger,
        private Database $db
    ) {}
}

$container->enableAutowiring();
$container->registerFromAttribute(Logger::class);
$userService = $container->get(UserService::class);
```

### –ü—Ä–∏–º–µ—Ä 3: –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

```php
$container->set('api', fn() => new ApiClient());

// Priority 10 ‚Äî –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –ø–µ—Ä–≤—ã–º
$container->decorate('api', fn($api) => new AuthDecorator($api), 10);

// Priority 5 ‚Äî –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –≤—Ç–æ—Ä—ã–º
$container->decorate('api', fn($api) => new LogDecorator($api), 5);

$api = $container->get('api');
// –ü–æ—Ä—è–¥–æ–∫: AuthDecorator -> LogDecorator -> ApiClient
```

### –ü—Ä–∏–º–µ—Ä 4: Compiled Container –¥–ª—è Production

```php
// Development: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
$container = new Container();
$container->set('app', fn() => new App());
$container->compileToFile(__DIR__ . '/cache/Container.php');

// Production: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ compiled –≤–µ—Ä—Å–∏–∏
require __DIR__ . '/cache/Container.php';
$container = new \CloudCastle\DI\Compiled\CompiledContainer();
// –ù–∞ 47% –±—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞!
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –ø–æ–∫—Ä—ã—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏:

- **38 Unit —Ç–µ—Å—Ç–æ–≤** ‚Äî 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- **5 Benchmark —Ç–µ—Å—Ç–æ–≤** ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **5 Load —Ç–µ—Å—Ç–æ–≤** ‚Äî 2M –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π
- **6 Stress —Ç–µ—Å—Ç–æ–≤** ‚Äî –¥–æ 15M –æ–ø–µ—Ä–∞—Ü–∏–π
- **10 Compiled —Ç–µ—Å—Ç–æ–≤** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ compiled container

–í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ CI/CD –Ω–∞ PHP 8.1, 8.2, 8.3, 8.4.

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–∏–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

- **4 —è–∑—ã–∫–∞:** –†—É—Å—Å–∫–∏–π, English, Deutsch, Fran√ßais
- **32 –æ—Ç—á—ë—Ç–∞ –ø–æ —Ç–µ—Å—Ç–∞–º** —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º
- **24 —Ñ–∞–π–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** ‚Äî –æ—Ç Quick Start –¥–æ API Reference
- **–†–∞–±–æ—á–∏–µ –ø—Ä–∏–º–µ—Ä—ã** –Ω–∞ –≤—Å–µ—Ö —è–∑—ã–∫–∞—Ö

## üéØ –î–ª—è –∫–æ–≥–æ?

CloudCastle DI –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:

- ‚úÖ **High-load –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π** ‚Äî –¥–æ 500k –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫
- ‚úÖ **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- ‚úÖ **Enterprise –ø—Ä–æ–µ–∫—Ç–æ–≤** ‚Äî –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ñ–∏—á
- ‚úÖ **Modern PHP** ‚Äî PHP 8+ –∏–∑ –∫–æ—Ä–æ–±–∫–∏

## üîó –°—Å—ã–ª–∫–∏

- **GitHub:** https://github.com/zorinalexey/cloud-casstle-di-container
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞:** `composer require cloud-castle/di-container`
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ 4 —è–∑—ã–∫–∞—Ö

## ü§ù –í–∫–ª–∞–¥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ

–ü—Ä–æ–µ–∫—Ç –æ—Ç–∫—Ä—ã—Ç –¥–ª—è contributions! –ë—É–¥—É —Ä–∞–¥:
- Pull requests —Å –Ω–æ–≤—ã–º–∏ —Ñ–∏—á–∞–º–∏
- –°–æ–æ–±—â–µ–Ω–∏—è–º –æ–± –æ—à–∏–±–∫–∞—Ö
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
- –ü–µ—Ä–µ–≤–æ–¥–∞–º –Ω–∞ –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

CloudCastle DI Container v2.0 ‚Äî —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ –∏–∑ Symfony, Laravel, PHP-DI –∏ —Å–æ–∑–¥–∞–Ω–∏—è —á–µ–≥–æ-—Ç–æ –ª—É—á—à–µ–≥–æ. –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω **–±—ã—Å—Ç—Ä—ã–π, –Ω–∞–¥—ë–∂–Ω—ã–π –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π** DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è PHP ‚Äî –ø–æ–ø—Ä–æ–±—É–π—Ç–µ CloudCastle DI!

‚≠ê –ë—É–¥—É –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω –∑–∞ –∑–≤–µ–∑–¥—É –Ω–∞ GitHub –∏ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å!

---

**–¢–µ–≥–∏:** #php #opensource #dependencyinjection #php8 #performance #symfony #laravel

